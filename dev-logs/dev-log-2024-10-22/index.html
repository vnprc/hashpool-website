<!doctype html><html dir=auto lang=en><head><meta charset=utf-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="index, follow" name=robots><title>btc++ and Nix</title><meta content="keyword1, keyword2, keyword3" name=keywords><meta name=description><meta content=vnprc name=author><link href=https://hashpool.dev/dev-logs/dev-log-2024-10-22/ rel=canonical><link href=https://hashpool.dev/css/includes/scroll-bar.css rel=stylesheet><link href=https://hashpool.dev/css/styles.css rel=stylesheet><link href=https://hashpool.dev/css/override.css rel=stylesheet><link href=https://hashpool.dev/atom.xml rel=alternate title=RSS type=application/atom+xml><noscript><style>#theme-toggle,.top-link{display:none}</style> <style>@media (prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:#dadadb;--secondary:#9b9c9d;--tertiary:#414244;--content:#c4c4c5;--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><body id=top><script>if(localStorage.getItem(`pref-theme`)===`dark`){document.body.classList.add(`dark`)}else if(localStorage.getItem(`pref-theme`)===`light`){document.body.classList.remove(`dark`)}else if(window.matchMedia(`(prefers-color-scheme: dark)`).matches){document.body.classList.add(`dark`)}</script><header class=header><nav class=nav><div class=logo><a title="Hashpool (Alt + H)" accesskey=h href=https://hashpool.dev> Hashpool </a><div class=logo-switches><button title="(Alt + T)" accesskey=t id=theme-toggle><svg viewbox="0 0 24 24" fill=none height=18 id=moon stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> <svg viewbox="0 0 24 24" fill=none height=18 id=sun stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></button><ul class=lang-switch><li></ul></div></div><ul id=menu><li><a href=https://hashpool.dev title=About> <span>About</span> </a><li><a title="Development Logs" href=https://hashpool.dev/dev-logs> <span>Development Logs</span> </a><li><a href=https://hashpool.dev/search title=Search> <span>Search</span> </a><li><a href=https://github.com/vnprc/hashpool title=Github> <span>Github</span> </a></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hashpool.dev>Home</a> »  <a href=https://hashpool.dev/dev-logs/>Developer Logs</a> »  <a href=https://hashpool.dev/dev-logs/dev-log-2024-10-22/>btc++ and Nix</a></div><h1 class=post-title>btc++ and Nix</h1><div class=post-meta><span title="2024-10-22 00:00:00 +0000">2024-10-22</span> · 5 min · vnprc</div></header><div class=post-content><p>I have not been making regular dev log updates due to personal and business travel, but I have not been idle. As Average Gary let me know, it's time to get back up on the horse. Side note: shout out to Gary! You are like a boxing coach who keeps me going when my internal drive starts to flag. Thank you, brother. &LT3<p>In the process of creating the presentation I delivered at btc++ I have uncovered significant gaps in my thinking. The biggest of these is my naive conception of PPLNS payouts. I was originally picturing what I now know is called proportional mining, where all shares are paid once each time a block is found. This is a bad idea for public pools because it leads to a behavior called pool hopping, which dramatically increases pool hashrate variability. It's actually not terrible if you have a whitelist of miners. I may use this payout method for the passthrough construction if it makes sense to do so but I suspect that once I code up the payout calculations it will be simpler and easier not to reimplement payouts.<p>There is a lack of quality educational material about pool payouts but I managed to find two good sources: a <a href="https://bitcointalk.org/index.php?topic=39832">2011 bitcointalk thread</a> and a <a href=https://mintpond.com/b/prop-vs-pplns-vs-pps-mining-pool-reward-systems>MintPond blog post</a> (MintPond is apparently a zcoin mining pool). The second reply on bitcointalk basically describes the use case of ehash at a high level. This is great confirmation that I'm on the right track! All the best ideas have already been discussed 10 years ago on bitcointalk. :)<p>With newfound understanding I rewrote the slide explaining how and why PPLNS works. I realized that I was barking up the wrong tree with an exponential decay function. I think that might work but it's actually much simpler to use a linear decay function. All we need to do is amortize share payouts to prevent pool hopping and a linear decay makes the math much simpler to understand. I have found that having simplicity as an engineering goal produces far better results in the long run, so let's keep it simple until we identify a need to make it complex.<p>At BTC++ Berlin I spent the week explaining my idea and sharpening my thoughts on it. After the conference I also had some productive conversations on the stratum v2 discord server research channel that have driven further improvements in my understanding. I brought away two big realizations from these conversations:<p>First: existing pools combine the roles of pricing hashrate and producing block templates. This is the moral hazard that has lead to an unhealthy market. Hashpool separates out the role of pricing hashrate. I want to get to a place where I can separate out block template production, but that won't be in the first version. At the end of the day pools should be dumb aggregators of hashrate that compete only in the quality of service they deliver, not via externalities to the core business like monopoly market positioning, deep capital accounts, or political connections.<p>My second realization, driven by the discussion with Matt Corallo on Discord, was that Hashpool is actually two different ideas. It combines the concept of a self-hosted adjunct mining pool with an ecash-powered free market for hashrate. You can build either concept in isolation but there are some synergies in combining them. Smaller pools should cater to smaller miners, so the adjunct mining pool concept really needs micropayments to make sense. You can build a mining pool with BOLT12 today, in fact Ocean and Braiins have already done this. Another micropayment solution is ecash payouts. I like this solution for its architectural simplicity, which I believe will allow for more innovation in the long run. For hashpool, you need a cashu server to implement ehash tokens. Since you are already running cashu to account for mining shares, it is a small leap to use it for payouts as well. This reduces the burden on wallets to support BOLT12 payouts and will drive far better UX due to the simplicity of the cashu spec. The other main benefit of building hashpool as an adjunct mining pool is that self-hosted Hashpools will be far more resilient to interference from the state. It's much harder to play whack-a-mole than to take down one large centralized service provider. With robust ehash marketplaces it should be easy to buy and sell ehash from different Hashpools on the same exchange.<p>Also, Bob McElrath of Braidpool commented during the discord discussion that I may have solved one of the problems they are wrestling with. They were also closing in on the idea of adjunct mining pools. This is another important signal that I'm on the right track. Another team working on a different design with a different approach also determined that a layered mining pool model served their needs best.<p>At the BTC++ hackathon I hooked up with some awesome devs who helped me nixify my setup. This is a huge win for me personally since my previous setup was to open 6 tabs and manually run a process in each tab. Now I can spin up the whole thing with a single terminal command, and it has a sexy terminal UI to boot!<p>This week is TABconf. I hope it is at least as productive as btc++! I suspect it will be even more so.</div><footer class=post-footer><nav class=paginav></nav></footer></article></main><footer class=footer><span>© 2025 <a href=https://github.com/vnprc>vnprc</a></span><span> Powered by <a rel="noopener noreferrer" href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/cydave/zola-theme-papermod rel=noopener target=_blank>PaperMod</a> </span></footer><a aria-label="go to top" title="Go to Top (Alt + G)" accesskey=g class=top-link href=#top id=top-link> <svg viewbox="0 0 12 6" fill=currentColor xmlns=http://www.w3.org/2000/svg><path d="M12 6H0l6-6z"/></svg> </a><script>let menu=document.getElementById(`menu`);if(menu){let a=`menu-scroll-position`;menu.scrollLeft=localStorage.getItem(a);menu.onscroll=(()=>{localStorage.setItem(a,menu.scrollLeft)})};document.querySelectorAll(`a[href^="#"]`).forEach(a=>{let c=null,b=decodeURIComponent;a.addEventListener(`click`,function(a){a.preventDefault();var d=this.getAttribute(`href`).substr(1);if(!window.matchMedia(`(prefers-reduced-motion: reduce)`).matches){document.querySelector(`[id='${b(d)}']`).scrollIntoView({behavior:`smooth`})}else{document.querySelector(`[id='${b(d)}']`).scrollIntoView()};if(d===`top`){history.replaceState(c,c,` `)}else{history.pushState(c,c,`#${d}`)}})})</script><script>var mybutton=document.getElementById(`top-link`);window.onscroll=(()=>{let a=800;if(document.body.scrollTop>a||document.documentElement.scrollTop>a){mybutton.style.visibility=`visible`;mybutton.style.opacity=`1`}else{mybutton.style.visibility=`hidden`;mybutton.style.opacity=`0`}})</script><script>document.getElementById(`theme-toggle`).addEventListener(`click`,()=>{let a=`dark`,b=`pref-theme`;if(document.body.className.includes(a)){document.body.classList.remove(a);localStorage.setItem(b,`light`)}else{document.body.classList.add(a);localStorage.setItem(b,a)}})</script><script>document.querySelectorAll(`pre > code`).forEach(a=>{let f=`TABLE`,e=`copy`;var d=(()=>{c.innerText=`copied!`;setTimeout(()=>{c.innerText=e},2000)});const b=a.parentNode.parentNode;const c=document.createElement(`button`);c.classList.add(`copy-code`);c.innerText=e;c.addEventListener(`click`,b=>{if(`clipboard` in navigator){var c=a.textContent;if(a.firstChild.tagName==f){c=Array(...a.firstChild.getElementsByTagName(`span`)).map(a=>a.textContent).join(``)};navigator.clipboard.writeText(c);d();return};const g=document.createRange();g.selectNodeContents(a);const h=window.getSelection();h.removeAllRanges();h.addRange(g);try{document.execCommand(e);d()}catch(a){}h.removeRange(g)});if(b.classList.contains(`highlight`)){b.appendChild(c)}else if(b.parentNode.firstChild==b){}else if(a.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==f){a.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(c)}else{a.parentNode.appendChild(c)}})</script>