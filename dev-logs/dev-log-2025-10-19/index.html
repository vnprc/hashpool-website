<!doctype html><html dir=auto lang=en><head><meta charset=utf-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="index, follow" name=robots><title>Sovereign Engineering: Technological Learnings of an American for Make Benefit Glorious Project of Bitcoin</title><meta content="keyword1, keyword2, keyword3" name=keywords><meta name=description><meta content=vnprc name=author><link href=https://hashpool.dev/dev-logs/dev-log-2025-10-19/ rel=canonical><link href=https://hashpool.dev/css/includes/scroll-bar.css rel=stylesheet><link href=https://hashpool.dev/css/styles.css rel=stylesheet><link href=https://hashpool.dev/css/override.css rel=stylesheet><link href=https://hashpool.dev/atom.xml rel=alternate title=RSS type=application/atom+xml><noscript><style>#theme-toggle,.top-link{display:none}</style> <style>@media (prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:#dadadb;--secondary:#9b9c9d;--tertiary:#414244;--content:#c4c4c5;--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><body class=list id=top><script>if(localStorage.getItem(`pref-theme`)===`dark`){document.body.classList.add(`dark`)}else if(localStorage.getItem(`pref-theme`)===`light`){document.body.classList.remove(`dark`)}else if(window.matchMedia(`(prefers-color-scheme: dark)`).matches){document.body.classList.add(`dark`)}</script><header class=header><nav class=nav><div class=logo><a title="Hashpool (Alt + H)" accesskey=h href=https://hashpool.dev> Hashpool </a><div class=logo-switches><button title="(Alt + T)" accesskey=t id=theme-toggle><svg viewbox="0 0 24 24" fill=none height=18 id=moon stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> <svg viewbox="0 0 24 24" fill=none height=18 id=sun stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></button><ul class=lang-switch><li></ul></div></div><ul id=menu><li><a href=https://hashpool.dev title=About> <span>About</span> </a><li><a title="Development Logs" href=https://hashpool.dev/dev-logs> <span>Development Logs</span> </a><li><a href=https://hashpool.dev/diagrams title=Diagrams> <span>Diagrams</span> </a><li><a href=https://hashpool.dev/media title=Media> <span>Media</span> </a><li><a href=https://hashpool.dev/contact title=Contact> <span>Contact</span> </a><li><a href=https://hashpool.dev/search title=Search> <span>Search</span> </a><li><a href=https://github.com/vnprc/hashpool title=Github> <span>Github</span> </a></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Sovereign Engineering: Technological Learnings of an American for Make Benefit Glorious Project of Bitcoin</h1></header><div class=toc style=margin-top:1em><details><summary title="(Alt + C)" accesskey=c><span class=details>Table of Contents</span></summary> <div class=inner><ul><li><a aria-label="Ehash Protocol Improvement" href=#ehash-protocol-improvement>Ehash Protocol Improvement</a><li><a aria-label="Nostr Mempool" href=#nostr-mempool>Nostr Mempool</a><li><a aria-label="Ehash Protocol Improvement and Payment Forwarding" href=#ehash-protocol-improvement-and-payment-forwarding>Ehash Protocol Improvement and Payment Forwarding</a><li><a aria-label="Ehash UI" href=#ehash-ui>Ehash UI</a><li><a aria-label=Deployment href=#deployment>Deployment</a><li><a aria-label=Refactor href=#refactor>Refactor</a><li><a aria-label="Deployment Process and Protocol Specs" href=#deployment-process-and-protocol-specs>Deployment Process and Protocol Specs</a><li><a aria-label=TABConf href=#tabconf>TABConf</a><li><a aria-label="Next Steps" href=#next-steps>Next Steps</a></ul></div></details></div><div class=post-content><p>For the past three months I've been pushing hard to accelerate development. The results are pretty good! I deployed a public Hashpool instance and even have a few miners donating hashrate. I vibed up two UIs: one for the proxy and one for the pool. I landed several large refactors to minimize the hashpool code footprint, stand up 4 new services, and extract the ehash logic into a dedicated protocol crate. This work is a preface to updating my SRI fork 3 major versions to get on the latest release. I also pushed out draft PRs for two new NUT specs.<p>My secret sauce was travelling to Madiera to participate in <a href=https://sovereignengineering.io/>Sovereign Engineering</a> Cohort 5 with a bunch of nostr freedom tech hackers. I spent three weeks in paradise walking the levadas, experimenting with new ideas, and leveling up my vibe skills. It was a great success! I was only able to stay for the first half of the cohort but I arrived back home more bullish than ever. I continued the Friday shipping schedule from home for the remainder of the cohort and followed it up with my favorite bitcoin conference, TABconf, where I sat on a mining decentralization panel.<h2 id=ehash-protocol-improvement>Ehash Protocol Improvement</h2><p>Before I travelled to Madiera, I was still hard at work hashing out the protocol (pun intended). It worked by creating locked quotes at the mint and letting the user's wallet sweep the quotes on demand using the locking privkey. But in order to make this work I had to communicate the mint quote to the wallet somehow. The easiest solution was to create a mint quote lookup API. This design degrades user privacy if the user reuses locking keys but it has the nice property of reusing the mint as a storage service for unclaimed ehash tokens, minimizing network trips necessary to mint ehash.<p>I opened a <a href=https://github.com/cashubtc/nuts/pull/277>PR</a> to the cashu NUTs repo to upstream this API. Calle nacked the proposal on privacy grounds so I began a refactor to the protocol that would return the quote ID to the proxy server via new Sv2 extension message channels. It was a big task that would involve a lot of new message types and channels between the different components of the mining pool. I had been avoiding making big changes to the Sv2 protocol but at this point the right path was clear to me. I began this work but did not get far before travelling to Madiera.<p>No problem, I told myself...I'm gonna vibe on nostr stuff and get back to ehash development later. lol<h2 id=nostr-mempool>Nostr Mempool</h2><p>For the first week of SovEng I wanted to start building nostr mempool. This is a project that has captured my imagination for some time now. The idea is to elevate bitcoin transaction relay to a new transport layer outside of the bitcoin peer-to-peer network. The benefits of this approach are manifold: we can drop all filter rules on transactions (spam AND policy filters), we can use ecash exogenous transaction fees to sidestep RBF and CPFP fee bumping restrictions, and, most importantly for my purposes, I can build a new set of truly public and permissionless transaction acceleration rails for the next generation of mining pools. I will write more on this topic as the project advances.<p>After a week of work I published my first rust crate <a href=https://crates.io/crates/bitcoin-nostr-relay>bitcoin-nostr-relay</a>. It's a dead simple library that speaks bitcoin RPC and nostr websockets. The basic idea is to periodically scan your bitcoin node's mempool for new transactions and broadcast them over nostr. When a new transaction is received from nostr the library will insert it into your node's mempool via RPC.<p>I vibed up a <a href=https://github.com/vnprc/tx-relay-playground>sandbox playground</a> to test the library. The sandbox environment runs two bitcoin nodes in blocks-only mode. They transmit blocks to each other but do not participate in bitcoin p2p transaction relay. Instead they both connect to a nostr relay using the <code>bitcoin-nostr-relay</code> crate and gossip transactions over nostr. It supports regtest and testnet4. Test cases include standard and non-standard bitcoin transactions. In the next upgrade I will add transaction filters so node runners who want to block spam (or any other type of transaction) from their node can easily do so.<h2 id=ehash-protocol-improvement-and-payment-forwarding>Ehash Protocol Improvement and Payment Forwarding</h2><p>My initial plan was to push nostr mempool and other projects forward for the duration of Sovereign Engineering but after the first week people kept asking me "wen ehash" so I pivoted and put the hammer down on ehash development for the remainder of the cohort. I think this is the correct order of development because nostr mempool only makes sense with a robust network of mining nodes. When it comes to transaction relay, only mining nodes matter. This is a fact that seems to be lost in the culture war debates.<p>For the second week I wanted to demo ehash payment forwarding to the cohort but I was still in the middle of a protocol refactor. I didn't want to build payment forwarding on top of the quote lookup API, which was on its way out, so I put my nose to the grindstone and finished the protocol refactor. I had to get outside of my comfort zone to vibe up a new set of Sv2 protocol extension messages between the mint and the other roles.<p>In the new architecture, the pool receives a share, creates a quote at the mint, and returns a success message immediately to the proxy. When the quote status is set to <code>PAID</code> (which currently happens immediately, but in the future will happen upon block template validation) the mint broadcasts the quote ID to the pool and the pool forwards it to the proxy over the new message channels. It felt really good to demystify much of the Sv2 messaging layer protocols by building new channel and message types.<p>This architecture allows the mint to maintain strict privacy of quote IDs, only ever sharing the quote ID with the party who generated it. Another benefit of this approach is that it allows the miner to automatically regain their privacy from the mint. When you mine to a mining pool today, you expose your IP address. So if you retrieve the ehash tokens directly from the quote that was created on a connection that exposed your IP, the mint can associate the IP used to create the quote with the IP used to redeem it.<p>One of the magical properties of ecash is that it only takes one transaction to regain your privacy. In the new architecture the proxy redeems the quotes directly, so no new IP address is doxxed. With payment forwarding the proxy makes an additional transaction, removing the possibility of the pool or mint linking the destination wallet IP to the mining IP.<p>With one day left I began vibing on cashu payment request forwarding. The idea is to receive the ehash tokens at the proxy and send them, encrypted, to a nostr relay where the user can claim them asynchronously. It was simple in concept and I got probably 90% of the way to a working implementation before demo time, but I did not produce a working implementation.<p>I felt pretty down leading up to my demo but the 5 or 6 projects before me all failed in one way or another so when I stood up to present and got a big laugh by pointing this out I felt much better. I still plan to build this feature and I've left the <a href=https://github.com/vnprc/hashpool/blob/master/docs/PAYMENT_FORWARDING.md>development</a> <a href=https://github.com/vnprc/hashpool/blob/master/docs/PAYMENT_REQUEST.md>plans</a> in the repo for when I get back to it. I think it's a killer usability feature and development should go much more smoothly next time I give it a go.<h2 id=ehash-ui>Ehash UI</h2><p>For the third week, my last week in Madiera, I wanted to demo ehash to a live audience for the first time. Gary did this in Austin a few months before but I had bigger designs. I wanted to vibe up a mining pool UI with a faucet, mine to it from a bitaxe, and demo claiming the ehash to a wallet. After trying to do too much the previous week and falling short of my goal I was feeling good about the more limited scope of this plan. No need to reinvent the protocol before beginning to tackle the demo.<p>I had not mined to hashpool directly from an ASIC before so I had to do a little work to align the pool and proxy difficulty adjustments. The problem I encountered when mining with a real ASIC was that the pool and proxy were both trying to adjust their difficulty targets, which lead to a kind of three body problem. It was very difficult to arrive at a stable difficulty target because both targets kept moving. My solution was to disable the proxy difficulty adjustment and let the pool be the source of truth. If you look at SRI release notes you will notice they recently implemented <a href=https://github.com/stratum-mining/stratum/issues/1647>the same solution</a>.<p>This was a quick win in my hacky architecture so I had plenty of time to vibe up a UI. Demo day was a great success! Inside of 6 minutes I demonstrated mining ehash from a bitaxe and claiming it to a cashu.me instance. Below you can see the first version of the UI. Not too bad! The LLM just decided it should have a green on black terminal aesthetic so I rolled with it. Bitchat vibes. No regrets.<p><img alt=primordial-hashpool-ui-1 src=/images/dev-logs/primordial-hashpool-ui-1.png> <img alt=primordial-hashpool-ui-2 src=/images/dev-logs/primordial-hashpool-ui-2.png> <img alt=primordial-hashpool-ui-3 src=/images/dev-logs/primordial-hashpool-ui-3.png><h2 id=deployment>Deployment</h2><p>I left Sovereign Engineering physically but I was still there in spirit. I spent most of the fourth week cleaning up the UI and deploying it. I fixed a ton of display issues, replaced all the emojis with svg icons from the <a href=https://bitcoinicons.com/>Bitcoin icons</a> project, stood up a vps, and deployed my dev environment to it. It was super hacky but it technically worked and it looked great.<p>In the process I had to discover how the ehash units would work. I wanted a system that would allow ehash from different pools to share a universal difficulty. This will be critical for hash traders to compare different ehash assets from different pools. The fundamental problem is that block header hashes are 256 bit numbers but cashu assets (in cdk) are 64 bit numbers. So I needed to shrink the representable range of share hashes by 75%. I did a little math and came up with a reasonable range.<p>I tasked MacchuPikachu with this <a href=https://github.com/vnprc/hashpool/issues/66>issue</a> some time ago and when I poked him he opened a PR with his work in progress fix. It worked great! I cherry-picked it into master with a couple of fix up commits, redacted the miner IPs, and launched the site. Teamwork makes the dreamwork. ü§ù<p>You can see the two sites now at <a href=https://pool.hashpool.dev>pool.hashpool.dev</a> and <a href=https://proxy.hashpool.dev>proxy.hashpool.dev</a>. I also stood up a forked version of cashu.me at <a href=https://wallet.hashpool.dev>wallet.hashpool.dev</a>. I had to fork it to enable the <code>HASH</code> currency unit and disable the others. I don't want people storing real money on my dev wallet because I am definitely going to rug them.<h2 id=refactor>Refactor</h2><p>When I chatted with <a href=https://github.com/machuPikacchuBTC>MacchuPikachu</a> in our development meeting he shared this <a href=https://github.com/humanlayer/advanced-context-engineering-for-coding-agents/blob/main/ace-fca.md>excellent resource</a> on vibe coding in large codebases. I could tell it was good because I had independently discovered many of the principles at work that the author describes. I decided to level up again and push forward a really big project: rebasing Hashpool onto the latest SRI version. I spent a day or two vibing up a development plan only to have my LLM give up the ghost immediately. Rebasing every SRI commit against every Hashpool commit for almost a year of work was not a feasible plan.<p>I did manage to get my version up to SRI 1.2.0 and extract some of the ehash logic into a separate crate. But in order to pull off this upgrade I was going to have to be a lot more aggressive. I started again with a new plan to split out the stats service from the pool and proxy services. After a lot of vibing I was ready to deploy on Friday afternoon. Ugh! I knew better but I needed to get it done to hold to the Friday shipping schedule so I pushed through.<p>My deployment process of building and running the entire environment on the VPS fell over at exactly that time. I forget my exact solution but it involved copying over the built binaries and running them manually. I got it working but my Friday evening was shot and it was only a temporary solution. What is that famous saying about deploying on Friday?<h2 id=deployment-process-and-protocol-specs>Deployment Process and Protocol Specs</h2><p>For my final week of SovEng I wanted to accomplish a long-term goal of publishing the NUT spec for minting ehash. But first, I had to fix the production deployment. I vibed up some proper deployment scripts and got them working. No more cargo builds on a CPU-throttled vps or out of memory errors!<p>I also refactored the roles again to split the stats and web services into separate roles and use a snapshot broadcast model instead of attempting to reconstruct the proper state from individual message announcements. This was necessary to clean up the litany of display and stale data issues. By now I was getting pretty comfortable vibing large refactors. It's really addictive to work hard and progress quickly!<p>With the project in a good state I crafted two new NUT specs and opened draft PRs. <a href=https://github.com/cashubtc/nuts/pull/292>Deterministic Derivation Paths</a> are necessary to enable a different unit for each ehash mining epoch. The <a href=https://github.com/cashubtc/nuts/pull/293>Mining Share Payment Method</a> details the process and key concerns of minting ehash tokens.<h2 id=tabconf>TABConf</h2><p>With SovEng in my rear view mirror I headed to Atlanta for my favorite bitcoin conference: <a href=https://tabconf.com>TABConf</a>. This was my first technical bitcoin conference many years ago and I have become a regular fixture since then.<p>I sat on a mining decentralization panel in the socratic village that went really well. A few people told me it was the best event of the conference. Cool! All the panel members also felt that it went well.<p>At the conference I discussed my work and my thinking with a bunch of people, including core devs working on compact block relay, <a href=https://github.com/mevpool/mevpool/blob/main/mevpool-marketplace.md>MEVpool</a> developers, Bob McElrath of <a href=https://github.com/braidpool/braidpool>Braidpool</a>, and I even got to meet <a href=https://gist.github.com/ChristopherA/a5082a08d17bdc4ebb2debb9a5cbb529>Christopher Allen</a> at a conference afterparty. (<a href=/images/dev-logs/omg.gif>I cashu pilled him!</a>)<p>I look forward to pursuing these working relationships and, as always, my brain is brimming with the possibility space that opened up from the things I learned and people I met at TABconf.<h2 id=next-steps>Next Steps</h2><p>I feel that progress on ehash and Hashpool has dramatically accelerated in the past few months. I am well positioned to finish the SRI version upgrade and start contributing to that team's discussions on splitting up the monorepo. I think I bring a valuable perspective as one of the first Sv2 extensions.<p>I am also ready to begin developing ehash redemptions. I have a really solid platform to generate ehash tokens, now we just need to turn them into sats. I discussed the protocol design with Calle in one of those 1 hour meetings that can save you 2 years of work so I have a <a href=https://github.com/vnprc/hashpool/blob/master/docs/EHASH_PROTOCOL.md>rough outline</a> of how to make it work. Now I just have to vibe it into reality. LFG :)</div><footer class=post-footer><nav class=paginav><a class=prev href=https://hashpool.dev/dev-logs/dev-log-2025-07-19/> <span class=title>¬´ Prev</span> <br> <span>Iterating on the Infrastructure</span> </a></nav></footer></article></main><footer class=footer><span>¬© 2025 <a href=https://github.com/vnprc>vnprc</a></span><span> Powered by <a rel="noopener noreferrer" href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/cydave/zola-theme-papermod rel=noopener target=_blank>PaperMod</a> </span></footer><a aria-label="go to top" title="Go to Top (Alt + G)" accesskey=g class=top-link href=#top id=top-link> <svg viewbox="0 0 12 6" fill=currentColor xmlns=http://www.w3.org/2000/svg><path d="M12 6H0l6-6z"/></svg> </a><script>let menu=document.getElementById(`menu`);if(menu){let a=`menu-scroll-position`;menu.scrollLeft=localStorage.getItem(a);menu.onscroll=(()=>{localStorage.setItem(a,menu.scrollLeft)})};document.querySelectorAll(`a[href^="#"]`).forEach(a=>{let c=null,b=decodeURIComponent;a.addEventListener(`click`,function(a){a.preventDefault();var d=this.getAttribute(`href`).substr(1);if(!window.matchMedia(`(prefers-reduced-motion: reduce)`).matches){document.querySelector(`[id='${b(d)}']`).scrollIntoView({behavior:`smooth`})}else{document.querySelector(`[id='${b(d)}']`).scrollIntoView()};if(d===`top`){history.replaceState(c,c,` `)}else{history.pushState(c,c,`#${d}`)}})})</script><script>var mybutton=document.getElementById(`top-link`);window.onscroll=(()=>{let a=800;if(document.body.scrollTop>a||document.documentElement.scrollTop>a){mybutton.style.visibility=`visible`;mybutton.style.opacity=`1`}else{mybutton.style.visibility=`hidden`;mybutton.style.opacity=`0`}})</script><script>document.getElementById(`theme-toggle`).addEventListener(`click`,()=>{let b=`pref-theme`,a=`dark`;if(document.body.className.includes(a)){document.body.classList.remove(a);localStorage.setItem(b,`light`)}else{document.body.classList.add(a);localStorage.setItem(b,a)}})</script><script>document.querySelectorAll(`pre > code`).forEach(a=>{let e=`copy`,f=`TABLE`;var d=(()=>{c.innerText=`copied!`;setTimeout(()=>{c.innerText=e},2000)});const b=a.parentNode.parentNode;const c=document.createElement(`button`);c.classList.add(`copy-code`);c.innerText=e;c.addEventListener(`click`,b=>{if(`clipboard` in navigator){var c=a.textContent;if(a.firstChild.tagName==f){c=Array(...a.firstChild.getElementsByTagName(`span`)).map(a=>a.textContent).join(``)};navigator.clipboard.writeText(c);d();return};const g=document.createRange();g.selectNodeContents(a);const h=window.getSelection();h.removeAllRanges();h.addRange(g);try{document.execCommand(e);d()}catch(a){}h.removeRange(g)});if(b.classList.contains(`highlight`)){b.appendChild(c)}else if(b.parentNode.firstChild==b){}else if(a.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==f){a.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(c)}else{a.parentNode.appendChild(c)}})</script>